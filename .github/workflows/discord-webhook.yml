name: Discord Notifications

on: 
  push:
    branches:
      - main
  issues:
    types: [opened, closed, labeled, unlabeled]
  issue_comment:
    types: [created]

jobs:
  discord_notification:
    runs-on: ubuntu-latest

    steps:
    - name: Send push notification to Discord
      if: github.event_name == 'push'
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: |
        curl -H "Content-Type: application/json" \
          -X POST \
          -d "{\"content\": \"üì¶ **${{ github.actor }}** pushed to **${{ github.repository }}**: [View commit](${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/commit/${GITHUB_SHA})\"}" \
          $DISCORD_WEBHOOK_URL

    - name: Send issue opened notification to Discord
      if: github.event_name == 'issues' && github.event.action == 'opened'
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: |
        curl -H "Content-Type: application/json" \
          -X POST \
          -d "{\"content\": \"üìù Issue opened by **${{ github.actor }}**: [${{ github.event.issue.title }}](${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/issues/${{ github.event.issue.number }})\"}" \
          $DISCORD_WEBHOOK_URL

    - name: Send status update for label change
      if: github.event_name == 'issues' && github.event.action == 'labeled'
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: |
        if [ "${{ github.event.label.name }}" == "Unsolved" ]; then
          curl -H "Content-Type: application/json" -X POST \
            -d "{\"content\": \"üî¥ Status changed to **Unsolved** for issue [${{ github.event.issue.title }}](${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/issues/${{ github.event.issue.number }}) by **${{ github.actor }}**\"}" \
            $DISCORD_WEBHOOK_URL
        elif [ "${{ github.event.label.name }}" == "In Progress" ]; then
          curl -H "Content-Type: application/json" -X POST \
            -d "{\"content\": \"üü† Status changed to **In Progress** for issue [${{ github.event.issue.title }}](${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/issues/${{ github.event.issue.number }}) by **${{ github.actor }}**\"}" \
            $DISCORD_WEBHOOK_URL
        elif [ "${{ github.event.label.name }}" == "Done" ]; then
          curl -H "Content-Type: application/json" -X POST \
            -d "{\"content\": \"‚úÖ Status changed to **Done** for issue [${{ github.event.issue.title }}](${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/issues/${{ github.event.issue.number }}) by **${{ github.actor }}**\"}" \
            $DISCORD_WEBHOOK_URL
        fi

    - name: Send issue closed notification to Discord
      if: github.event_name == 'issues' && github.event.action == 'closed'
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: |
        curl -H "Content-Type: application/json" \
          -X POST \
          -d "{\"content\": \"‚úÖ Issue closed by **${{ github.actor }}**: [${{ github.event.issue.title }}](${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/issues/${{ github.event.issue.number }})\"}" \
          $DISCORD_WEBHOOK_URL

    - name: Send issue comment notification to Discord
      if: github.event_name == 'issue_comment' && github.event.action == 'created'
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: |
        curl -H "Content-Type: application/json" \
          -X POST \
          -d "{\"content\": \"üí¨ New comment by **${{ github.actor }}** on issue [${{ github.event.issue.title }}](${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/issues/${{ github.event.issue.number }}):\n\n${{ github.event.comment.body }}\"}" \
          $DISCORD_WEBHOOK_URL
